{"version":3,"file":"SupertypeLogger.js","sourceRoot":"","sources":["../SupertypeLogger.ts"],"names":[],"mappings":"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","sourcesContent":["const levelToStr = { 60: 'fatal', 50: 'error', 40: 'warn', 30: 'info', 20: 'debug', 10: 'trace' };\nconst strToLevel = { 'fatal': 60, 'error': 50, 'warn': 40, 'info': 30, 'debug': 20, 'trace': 10 };\n\nfunction isObject(obj) {\n    return obj != null\n        && typeof (obj) === 'object'\n        && !(obj instanceof Array)\n        && !(obj instanceof Date)\n        && !(obj instanceof Error);\n}\n\ntype LogObject = {\n    level: string;\n    time: string;\n    msg: string;\n    module?: any;\n    activity?: any;\n};\n\nexport class SupertypeLogger {\n    context: any;\n    granularLevels: any;\n    level: any;\n\n    // for overriding\n    // sendToLog: Function;\n    // formatDateTime: Function;\n\n    constructor() {\n        this.context = {};\n        this.granularLevels = {};\n        this.level = 'info';\n    }\n\n\n    fatal(...data: any[]): void {\n        this.log(60, ...data);\n    }\n\n    error(...data: any[]): void {\n        this.log(50, ...data);\n    }\n\n    warn(...data: any[]): void {\n        this.log(40, ...data);\n    }\n\n    info(...data: any[]): void {\n        this.log(30, ...data);\n    }\n    debug(...data: any[]): void {\n        this.log(20, ...data);\n    }\n    trace(...data: any[]): void {\n        this.log(10, ...data);\n    }\n\n    // Log all arguments assuming the first one is level and the second one might be an object (similar to banyan)\n    log(level: number, ...data: any[]): void {\n        let msg = '';\n        const obj: LogObject = {\n            time: (new Date()).toISOString(),\n            msg: '',\n            level: 'info', //default info\n        };\n\n        for (const prop in this.context) {\n            obj[prop] = this.context[prop];\n        }\n\n        for (let ix = 0; ix < arguments.length; ++ix) {\n            const arg = arguments[ix];\n            if (ix == 0) {\n                obj.level = arg;\n            }\n            else if (ix == 1 && isObject(arg)) { // error when we try to log an object with property 'level'\n                for (const proper in arg) {\n                    obj[proper] = arg[proper];\n                }\n            }\n            else {\n                msg += `${arg} `;\n            }\n        }\n\n        if (obj.msg.length) {\n            obj.msg += ' ';\n        }\n\n        if (msg.length) {\n            if (obj.module && obj.activity) {\n                obj.msg += `${obj.module}[${obj.activity}] - `;\n            }\n\n            obj.msg += msg;\n        }\n        else if (obj.module && obj.activity) {\n            obj.msg += `${obj.module}[${obj.activity}]`;\n        }\n\n        if (this.isEnabled(levelToStr[obj.level], obj)) {\n            this.sendToLog(levelToStr[obj.level], obj);\n        }\n    }\n\n    startContext(context) {\n        this.context = context;\n    }\n\n    // Save the properties in the context and return a new object that has the properties only so they can be cleared\n    setContextProps(context) {\n        const reverse = {};\n\n        for (const prop in context) {\n            reverse[prop] = true;\n            this.context[prop] = context[prop];\n        }\n\n        return reverse;\n    }\n    // Parse log levels such as warn.activity\n    setLevel(level) {\n        var levels = level.split(';');\n\n        for (var ix = 0; ix < levels.length; ++ix) {\n            var levela = levels[ix];\n\n            if (levela.match(/:/)) {\n                if (levels[ix].match(/(.*):(.*)/)) {\n                    this.granularLevels[RegExp.$1] = this.granularLevels[RegExp.$1] || {};\n                    this.granularLevels[RegExp.$1] = RegExp.$2;\n                }\n                else {\n                    this.level = levels[ix];\n                }\n            }\n            else {\n                this.level = levela;\n            }\n        }\n    }\n\n    // Remove any properties recorded by setContext\n    clearContextProps(contextToClear) {\n        for (const prop in contextToClear) {\n            delete this.context[prop];\n        }\n    }\n\n    // Create a new logger and copy over it's context\n    createChildLogger(context): SupertypeLogger {\n        let child: { [key: string]: any } = {};\n\n        for (let prop in this) {\n            child[prop] = this[prop];\n        }\n\n        child.context = context || {};\n\n        for (let proper in this.context) {\n            child.context[proper] = this.context[proper];\n        }\n\n        return child as SupertypeLogger; // bad practice but should fix\n    }\n\n    formatDateTime(date): string {\n        return f(2, (date.getMonth() + 1), '/') + f(2, date.getDate(), '/') + f(4, date.getFullYear(), ' ') +\n            f(2, date.getHours(), ':') + f(2, date.getMinutes(), ':') + f(2, date.getSeconds(), ':') +\n            f(3, date.getMilliseconds()) + ' GMT' + (0 - date.getTimezoneOffset() / 60);\n\n        function f(z, d, s?) {\n            while (String(d).length < z) {\n                d = '0' + d;\n            }\n\n            return d + (s || '');\n        }\n    }\n\n    sendToLog(level, json) {\n        console.log(this.prettyPrint(level, json));     // eslint-disable-line no-console\n    }\n\n    prettyPrint(level, json) {\n        let split = this.split(json, {time: 1, msg: 1, level: 1, name: 1});\n\n        return this.formatDateTime(new Date(json.time)) + ': ' + \n                                    level.toUpperCase() + ': ' + \n                                    addColonIfToken(split[1].name, ': ') + \n                                    addColonIfToken(split[1].msg, ': ') + \n                                    xy(split[0]);\n\n        function addColonIfToken (token, colonAndSpace) {\n            if (token) {\n                return token + colonAndSpace;\n            }\n\n            return '';\n        }\n\n        function xy(j) {\n            var str = '';\n            var sep = '';\n\n            for (var prop in j) {\n                str += sep + prop + '=' + JSON.stringify(j[prop]);\n                sep = ' ';\n            }\n\n            if (str.length > 0) {\n                return '(' + str + ')';\n            }\n\n            return '';\n        }\n    }\n\n    private split(json, props): any[] {\n        const a = {};\n        const b = {};\n\n        for (const prop in json) {\n            (props[prop] ? b : a)[prop] = json[prop];\n        }\n\n        return [a, b];\n    }\n\n    // Logging is enabled if either the level threshold is met or the granular level matches\n    private isEnabled(level, obj) {\n        level = strToLevel[level];\n\n        if (level >= strToLevel[this.level]) {\n            return true;\n        }\n\n        if (this.granularLevels) {\n            for (let levelr in this.granularLevels) {\n                if (obj[levelr] && obj[levelr] == this.granularLevels[levelr]) {\n                    return true;\n                }\n            }\n        }\n    }\n}"]}